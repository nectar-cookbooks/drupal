<?php
// $Id: default.settings.php,v 1.51 2010/10/11 23:49:48 dries Exp $

/**
 * @file
 * Drupal site-specific configuration file.
 *
 * IMPORTANT NOTE:
 * This file may have been set to read-only by the Drupal installation
 * program. If you make changes to this file, be sure to protect it again
 * after making your modifications. Failure to remove write permissions
 * to this file is a security risk.
 *
 * Initial copy generated by Chef.
 *
 * For the config file documentation, please refer to the comments in the
 * sites/default/settings.php file.
 */

<% 
   drupal = node['drupal']
   dbs = drupal['databases']
   if dbs && !dbs.empty? then
     dbs.each do |key, attrs|
       keys = /^([^\/]+)\/([^\/]+)$/.match(key)
       raise "Invalid database keys #{key}" unless keys
%>
$databases['<%= keys[1] %>', '<%= keys[2] %>'] = array(
<%     attrs.each do |attr, val| %>
  '<%= attr %>' => '<%= val %>', 
<%     end
%>
);
<% 
     end
   else 
%>
$databases = array();
<% end %>
require_once('dbconfig.php');

$update_free_access = <%= drupal['update_free_access'] ? 'TRUE' : 'FALSE' %>;

$drupal_hash_salt = <%= drupal['hash_salt'] %>;

if (file_exists('baseurl.php')) 
	include_once('baseurl.php');

ini_set('session.gc_probability', 1);
ini_set('session.gc_divisor', 100);
ini_set('session.gc_maxlifetime', 200000);

ini_set('session.cookie_lifetime', <%= drupal['session_cookie_lifetime'] %>);

<% if drupal['pcre_backtrack_limit'] then %>
ini_set('pcre.backtrack_limit', <%= drupal['pcre_backtrack_limit'] %>);
<% else %>
# ini_set('pcre.backtrack_limit', 200000);
<% end %>

<% if drupal['pcre_recursion_limit'] then %>
ini_set('pcre.recursion_limit', <%= drupal['pcre_recursion_limit'] %>);
<% else %>
# ini_set('pcre.recurseion_limit', 200000);
<% end %>

<% if drupal['cookie_domain'] then %>
$cookie_domain = '<%= drupal['cookie_domain'] %>';
<% else %>
# $cookie_domain = 'example.com';
<% end %>

<% if drupal['site_name'] then %>
$conf['site_name'] = '<%= drupal['site_name'] %>';
<% else %>
# $conf['site_name'] = 'My Drupal site';
<% end %>

<% if drupal['theme_default'] then %>
$conf['theme_default'] = '<%= drupal['theme_default'] %>';
<% else %>
# $conf['theme_default'] = 'garland';
<% end %>

<% if drupal['anonymous'] then %>
$conf['anonymous'] = '<%= drupal['anonymous']  %>';
<% else %>
# $conf['anonymous'] = 'Visitor';
<% end %>

<% if drupal['maintenance_theme'] then %>
$conf['maintenance_theme'] = '<%= drupal['maintenance_theme'] %>';
<% else %>
# $conf['maintenance_theme'] = 'bartik';
<% end %>

<%= drupal['reverse_proxy'] ? '' : '# ' %>$conf['reverse_proxy'] = TRUE;

<% if drupal['reverse_proxy_header'] then %>
$conf['reverse_proxy_header'] = '<%= drupal['reverse_proxy_header'] %>';
<% else %>
# $conf['reverse_proxy_header'] = 'HTTP_X_CLUSTER_CLIENT_IP';
<% end %>

<% if drupal['reverse_proxy_addresses'] then %>
$conf['reverse_proxy_addresses'] = array(
<%   drupal['reverse_proxy_addresses'].each do |ip| %>
        '<%= ip %>',
<%   end %>
);
<% else %>
# $conf['reverse_proxy_addresses'] = array('a.b.c.d', ...);
<% end %>

<%= drupal['omit_vary_cookie'] ? '# ' : '' %>$conf['omit_vary_cookie'] = TRUE;

<%= drupal['css_gzip_compression'] ? '' : '# ' %>$conf['css_gzip_compression'] = FALSE;
<%= drupal['js_gzip_compression'] ? '' : '# ' %>$conf['js_gzip_compression'] = FALSE;

<% strings = drupal['locale_custom_strings_en']
   if strings && !strings.empty? then %>
$conf['locale_custom_strings_en'][''] = array(
<%   strings.each do |f, t| %>
        '<%= f %>' => '<%= t %>',
<%   end %>
);
<% else %>
# $conf['locale_custom_strings_en'][''] = array(
#   'forum'      => 'Discussion board',
#   '@count min' => '@count minutes',
# );
<% end %>

<% if drupal['blocked_ips'] then %>
$conf['blocked_ips'] = array(
<%   drupal['blocked_ips'].each do |ip| %>
        '<%= ip %>',
<%   end %>
);
<% else %>
# $conf['blocked_ips'] = array(
#   'a.b.c.d',
# );
<% end %>

<%= drupal['allow_authorize_operations'] ? '# ' : '' %>$conf['allow_authorize_operations'] = FALSE;
